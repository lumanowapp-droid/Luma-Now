import{create as M}from"zustand";import{immer as $}from"zustand/middleware/immer";var l=()=>typeof window<"u"&&typeof localStorage<"u",m={getItem:async e=>{try{return l()?localStorage.getItem(e):null}catch(t){return console.error("localStorage.getItem failed:",t),null}},setItem:async(e,t)=>{try{if(!l())return;localStorage.setItem(e,t)}catch(r){console.error("localStorage.setItem failed:",r)}},removeItem:async e=>{try{if(!l())return;localStorage.removeItem(e)}catch(t){console.error("localStorage.removeItem failed:",t)}}};var f=(e,t)=>(r,a,o)=>{let{name:s,version:n,partialize:S,onRehydrateStorage:d}=t,L=async()=>{try{let i=await m.getItem(s);if(i){let c=JSON.parse(i);c.version===n?(r(c.state),d&&d(a())):(console.warn(`State version mismatch for "${s}": expected ${n}, got ${c.version}`),await m.removeItem(s))}}catch(i){console.error(`Failed to load persisted state for "${s}":`,i)}},P=async i=>{try{let h={state:S?S(i):i,version:n},w=JSON.stringify(h);await m.setItem(s,w)}catch(c){console.error(`Failed to persist state for "${s}":`,c)}};return o.subscribe(i=>{P(i)}),L(),e(r,a,o)};var p={text:"",isProcessing:!1},g=e=>({...p,setText:t=>{e(r=>{r.text=t})},setIsProcessing:t=>{e(r=>{r.isProcessing=t})},compress:async()=>{e(t=>{t.isProcessing=!0})},reset:()=>{e(t=>{t.text=p.text,t.isProcessing=p.isProcessing})}});var A={tasks:[]},T=e=>({...A,addTask:t=>{e(r=>{let a={...t,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date,order:r.tasks.length};r.tasks.push(a)})},addTasks:t=>{e(r=>{let a=r.tasks.length,o=t.map((s,n)=>({...s,id:`${Date.now()}-${n}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date,order:a+n}));r.tasks.push(...o)})},toggleTask:t=>{e(r=>{let a=r.tasks.find(o=>o.id===t);a&&(a.completed=!a.completed,a.completedAt=a.completed?new Date:void 0)})},removeTask:t=>{e(r=>{let a=r.tasks.findIndex(o=>o.id===t);a!==-1&&(r.tasks.splice(a,1),r.tasks.forEach((o,s)=>{o.order=s}))})},updateTask:(t,r)=>{e(a=>{let o=a.tasks.find(s=>s.id===t);o&&Object.assign(o,r)})},clearCompleted:()=>{e(t=>{t.tasks=t.tasks.filter(r=>!r.completed),t.tasks.forEach((r,a)=>{r.order=a})})},reorderTasks:t=>{e(r=>{let a=new Map(r.tasks.map(o=>[o.id,o]));r.tasks=t.map(o=>a.get(o)).filter(Boolean),r.tasks.forEach((o,s)=>{o.order=s})})}});var u={light:3,medium:5,full:7},D={currentCapacity:"medium",maxTasks:u.medium},k=e=>({...D,setCapacity:t=>{e(r=>{r.currentCapacity=t,r.maxTasks=u[t]})},getMaxTasksForCapacity:t=>u[t]});var F={currentTaskId:null,elapsedTime:0,isActive:!1},y=e=>({...F,startFocus:t=>{e(r=>{r.currentTaskId=t,r.elapsedTime=0,r.isActive=!0})},endFocus:()=>{e(t=>{t.currentTaskId=null,t.elapsedTime=0,t.isActive=!1})},updateElapsedTime:t=>{e(r=>{r.elapsedTime=t})}});var O={currentView:"brain-dump",modalOpen:null},C=e=>({...O,setCurrentView:t=>{e(r=>{r.currentView=t})},openModal:t=>{e(r=>{r.modalOpen=t})},closeModal:()=>{e(t=>{t.modalOpen=null})}});var b=()=>"cloudflare",x={defaultCapacity:"medium",theme:"system",reducedMotion:!1,highContrast:!1,fontSize:"medium",hapticFeedback:!0,voiceInput:!1,gentleNudges:!0,dailyReflection:!1,hasCompletedOnboarding:!1,aiProvider:b()},z={settings:x},v=e=>({...z,updateSettings:t=>{e(r=>{r.settings={...r.settings,...t}})},resetSettings:()=>{e(t=>{t.settings=x})}});var I=M()($(f((...e)=>({...g(...e),...T(...e),...k(...e),...y(...e),...C(...e),...v(...e)}),{name:"luma-store",version:1,partialize:e=>({tasks:e.tasks,currentCapacity:e.currentCapacity,maxTasks:e.maxTasks,settings:e.settings}),onRehydrateStorage:e=>{console.log("Luma store rehydrated from storage")}}))),B=e=>e.tasks,U=e=>e.currentView,E=e=>({level:e.currentCapacity,max:e.maxTasks}),V=e=>e.settings,N=e=>e.text,R=e=>e.isProcessing,j=e=>({taskId:e.currentTaskId,elapsed:e.elapsedTime,active:e.isActive}),G=e=>e.modalOpen;export{N as selectBrainDumpText,E as selectCapacity,U as selectCurrentView,j as selectFocusState,R as selectIsProcessing,G as selectModalOpen,V as selectSettings,B as selectTasks,m as storage,I as useAppStore,I as useLumaStore};
//# sourceMappingURL=index.mjs.map