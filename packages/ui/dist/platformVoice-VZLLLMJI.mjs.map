{"version":3,"sources":["../../core/src/voice/platformVoice.web.ts"],"sourcesContent":["/**\n * Web Voice Implementation\n *\n * Uses Web Audio API for recording and OpenAI Whisper for transcription.\n * Note: Requires HTTPS for microphone access.\n */\n\nimport type {\n  VoiceService,\n  VoiceRecording,\n  TranscriptionResult,\n} from './index';\n\nexport class VoiceServiceImpl implements VoiceService {\n  private mediaRecorder: MediaRecorder | null = null;\n  private audioChunks: Blob[] = [];\n  private stream: MediaStream | null = null;\n\n  async requestPermissions(): Promise<boolean> {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      stream.getTracks().forEach(track => track.stop());\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async startRecording(): Promise<void> {\n    this.audioChunks = [];\n\n    this.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n    this.mediaRecorder = new MediaRecorder(this.stream, {\n      mimeType: 'audio/webm',\n    });\n\n    this.mediaRecorder.ondataavailable = event => {\n      if (event.data.size > 0) {\n        this.audioChunks.push(event.data);\n      }\n    };\n\n    this.mediaRecorder.start();\n  }\n\n  async stopRecording(): Promise<VoiceRecording> {\n    return new Promise((resolve, reject) => {\n      if (!this.mediaRecorder) {\n        reject(new Error('No active recording'));\n        return;\n      }\n\n      this.mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });\n        const uri = URL.createObjectURL(audioBlob);\n\n        // Stop all tracks\n        this.stream?.getTracks().forEach(track => track.stop());\n\n        resolve({\n          uri,\n          duration: 0, // Duration not easily available in web\n          mimeType: 'audio/webm',\n        });\n      };\n\n      this.mediaRecorder.stop();\n    });\n  }\n\n  async transcribe(recording: VoiceRecording): Promise<TranscriptionResult> {\n    // Fetch the blob from the object URL\n    const response = await fetch(recording.uri);\n    const audioBlob = await response.blob();\n\n    // Create FormData for API request\n    const formData = new FormData();\n    formData.append('audio', audioBlob, 'recording.webm');\n\n    // Call transcription API endpoint\n    const apiResponse = await fetch('/api/transcribe', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!apiResponse.ok) {\n      throw new Error('Transcription failed');\n    }\n\n    const result = await apiResponse.json();\n    return {\n      text: result.text,\n      confidence: result.confidence,\n      language: result.language,\n    };\n  }\n\n  isAvailable(): boolean {\n    return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\n  }\n\n  isEnabled(): boolean {\n    // Voice input always enabled on web if available\n    return true;\n  }\n}\n"],"mappings":"6BAaO,IAAMA,EAAN,KAA+C,CAC5C,cAAsC,KACtC,YAAsB,CAAC,EACvB,OAA6B,KAErC,MAAM,oBAAuC,CAC3C,GAAI,CAEF,OADe,MAAM,UAAU,aAAa,aAAa,CAAE,MAAO,EAAK,CAAC,GACjE,UAAU,EAAE,QAAQC,GAASA,EAAM,KAAK,CAAC,EACzC,EACT,MAAQ,CACN,MAAO,EACT,CACF,CAEA,MAAM,gBAAgC,CACpC,KAAK,YAAc,CAAC,EAEpB,KAAK,OAAS,MAAM,UAAU,aAAa,aAAa,CAAE,MAAO,EAAK,CAAC,EAEvE,KAAK,cAAgB,IAAI,cAAc,KAAK,OAAQ,CAClD,SAAU,YACZ,CAAC,EAED,KAAK,cAAc,gBAAkBC,GAAS,CACxCA,EAAM,KAAK,KAAO,GACpB,KAAK,YAAY,KAAKA,EAAM,IAAI,CAEpC,EAEA,KAAK,cAAc,MAAM,CAC3B,CAEA,MAAM,eAAyC,CAC7C,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,GAAI,CAAC,KAAK,cAAe,CACvBA,EAAO,IAAI,MAAM,qBAAqB,CAAC,EACvC,MACF,CAEA,KAAK,cAAc,OAAS,IAAM,CAChC,IAAMC,EAAY,IAAI,KAAK,KAAK,YAAa,CAAE,KAAM,YAAa,CAAC,EAC7DC,EAAM,IAAI,gBAAgBD,CAAS,EAGzC,KAAK,QAAQ,UAAU,EAAE,QAAQJ,GAASA,EAAM,KAAK,CAAC,EAEtDE,EAAQ,CACN,IAAAG,EACA,SAAU,EACV,SAAU,YACZ,CAAC,CACH,EAEA,KAAK,cAAc,KAAK,CAC1B,CAAC,CACH,CAEA,MAAM,WAAWC,EAAyD,CAGxE,IAAMF,EAAY,MADD,MAAM,MAAME,EAAU,GAAG,GACT,KAAK,EAGhCC,EAAW,IAAI,SACrBA,EAAS,OAAO,QAASH,EAAW,gBAAgB,EAGpD,IAAMI,EAAc,MAAM,MAAM,kBAAmB,CACjD,OAAQ,OACR,KAAMD,CACR,CAAC,EAED,GAAI,CAACC,EAAY,GACf,MAAM,IAAI,MAAM,sBAAsB,EAGxC,IAAMC,EAAS,MAAMD,EAAY,KAAK,EACtC,MAAO,CACL,KAAMC,EAAO,KACb,WAAYA,EAAO,WACnB,SAAUA,EAAO,QACnB,CACF,CAEA,aAAuB,CACrB,MAAO,CAAC,EAAE,UAAU,cAAgB,UAAU,aAAa,aAC7D,CAEA,WAAqB,CAEnB,MAAO,EACT,CACF","names":["VoiceServiceImpl","track","event","resolve","reject","audioBlob","uri","recording","formData","apiResponse","result"]}